# –ú–æ–¥—É–ª–∏ —Å–µ—Ä–≤–∏—Å–∞

## üóÉ bot.database.py
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite —á–µ—Ä–µ–∑ SQLAlchemy. –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –æ–±–ª–∏–≥–∞—Ü–∏—è—Ö.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –°–æ–∑–¥–∞—ë—Ç –¥–≤–∏–∂–æ–∫ –∏ —Å–µ—Å—Å–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (engine, Session, get_session()).

- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ `init_db()`.

- –û–ø–∏—Å—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª–∏:
    
  **User** ‚Äî Telegram-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å tg_id, full_name –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –æ–±–ª–∏–≥–∞—Ü–∏—è–º–∏.
    
  **TrackedBond** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–∞—è –æ–±–ª–∏–≥–∞—Ü–∏—è —Å isin, figi, class_code, –≤—Ä–µ–º–µ–Ω–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

`update_tracked_bond_figi()` ‚Äî –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –∏–∑–≤–Ω–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è **FIGI** –∏ **class_code** —É –æ–±–ª–∏–≥–∞—Ü–∏–∏.

## ü§ñ bot.handlers.py
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ Telegram: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–∏–≥–∞—Ü–∏–π.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ `register_handlers(app)`.

- –†–µ–∞–ª–∏–∑—É–µ—Ç –¥–∏–∞–ª–æ–≥–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è **ISIN** —á–µ—Ä–µ–∑ `ConversationHandler`.

- –§—É–Ω–∫—Ü–∏–∏:

  `start()` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –µ–≥–æ –≤ –ë–î.

  `list_tracked_bonds()` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –±—É–º–∞–≥–∏.

  `add_command()` ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±–ª–∏–≥–∞—Ü–∏–∏.

  `process_add_isin()` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ISIN, –¥–æ–±–∞–≤–ª—è–µ—Ç –±—É–º–∞–≥—É, –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–º—è –∏ FIGI.

  `remove_command()` ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —É–¥–∞–ª–µ–Ω–∏—è –æ–±–ª–∏–≥–∞—Ü–∏–∏.

  `process_remove_isin()` ‚Äî —É–¥–∞–ª—è–µ—Ç –æ–±–ª–∏–≥–∞—Ü–∏—é –ø–æ ISIN, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è.

## üîî bot.notifications.py
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –ú–æ–¥—É–ª—å, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö –ø–æ –æ–±–ª–∏–≥–∞—Ü–∏—è–º (–∫—É–ø–æ–Ω—ã, –ø–æ–≥–∞—à–µ–Ω–∏—è –∏ —Ç.–¥.).

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –¥–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:

- T-API (get_bond_coupons_tinkoff()).

- MOEX (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫).

- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç —á–µ—Ä–µ–∑ 3 –¥–Ω—è.

- –§—É–Ω–∫—Ü–∏–∏:

  `get_bond_coupons_tinkoff(figi, from_date, to_date)` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –∫—É–ø–æ–Ω—ã –ø–æ **FIGI** –æ—Ç –¢–∏–Ω—å–∫–æ—Ñ—Ñ.

  `check_and_notify(bot)` ‚Äî –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞—Ç—É +3 –¥–Ω—è –æ—Ç —Ç–µ–∫—É—â–µ–π.

## üîç database/figi_lookup.py
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –ü–æ–ª—É—á–∞–µ—Ç **FIGI** –∏ **class_code** –ø–æ —Ç–∏–∫–µ—Ä—É –æ–±–ª–∏–≥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ T-Invest API.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç **ticker**, –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ InstrumentsService, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **figi** –∏ **class_code**.

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–±–ª–∏–≥–∞—Ü–∏–∏ –≤ –±–∞–∑—É.

- –§—É–Ω–∫—Ü–∏—è:

  `get_figi_and_class_code_by_ticker(ticker: str)` ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (**figi**, **class_code**) –∏–ª–∏ (None, None) –µ—Å–ª–∏ –Ω–µ –Ω–∞—à—ë–ª.

## üß≠ database/moex_lookup.py
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫—É–ø–æ–Ω–∞—Ö –∏ –ø–æ–≥–∞—à–µ–Ω–∏—è—Ö —á–µ—Ä–µ–∑ MOEX ISS, –µ—Å–ª–∏ Tinkoff API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ISIN, –¥–µ–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å –∫ MOEX, –ø–∞—Ä—Å–∏—Ç JSON-–æ—Ç–≤–µ—Ç.

- –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è, –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

- –§—É–Ω–∫—Ü–∏—è:

  `get_bond_events_from_moex(isin: str, event_date: Optional[datetime] = None)` ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π —Å —Ç–∏–ø–æ–º, –¥–∞—Ç–æ–π, –∑–Ω–∞—á–µ–Ω–∏–µ–º (–∫—É–ø–æ–Ω –∏–ª–∏ –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è).

## üè∑ database/moex_name_lookup.py
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±–ª–∏–≥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ MOEX –ø–æ **ISIN**.

- –§—É–Ω–∫—Ü–∏—è:

  `get_bond_name_by_isin(isin: str)`‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ None.

## üîÑ update.py
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –°–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç **FIGI** –∏ **class_code** —É —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â—ë –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å ISIN-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –Ω–∞ T-API.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –ò—â–µ—Ç –æ–±–ª–∏–≥–∞—Ü–∏–∏ –≤ –±–∞–∑–µ, —É –∫–æ—Ç–æ—Ä—ã—Ö **figi** –∏–ª–∏ **class_code** –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.

- –ü–æ–ª—É—á–∞–µ—Ç **ticker** –∏–∑ **ISIN** (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Ç–∞ –∂–µ —Å—Ç—Ä–æ–∫–∞).

- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç **FIGI** –∏ **class_code** —á–µ—Ä–µ–∑ `get_figi_and_class_code_by_ticker`.

- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ –±–∞–∑–µ.


